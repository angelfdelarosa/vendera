(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8],{285:(e,r,t)=>{"use strict";t.d(r,{$:()=>o,r:()=>d});var s=t(5155),a=t(2115),l=t(4253),n=t(2085),i=t(9434);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=a.forwardRef((e,r)=>{let{className:t,variant:a,size:n,asChild:o=!1,...c}=e,u=o?l.DX:"button";return(0,s.jsx)(u,{className:(0,i.cn)(d({variant:a,size:n,className:t})),ref:r,...c})});o.displayName="Button"},1394:(e,r,t)=>{"use strict";t.d(r,{Avatar:()=>i,AvatarFallback:()=>o,AvatarImage:()=>d});var s=t(5155),a=t(2115),l=t(5977),n=t(9434);let i=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(l.bL,{ref:r,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...a})});i.displayName=l.bL.displayName;let d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(l._V,{ref:r,className:(0,n.cn)("h-full w-full",t),...a})});d.displayName=l._V.displayName;let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(l.H4,{ref:r,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...a})});o.displayName=l.H4.displayName},2523:(e,r,t)=>{"use strict";t.d(r,{p:()=>n});var s=t(5155),a=t(2115),l=t(9434);let n=a.forwardRef((e,r)=>{let{className:t,type:a,...n}=e;return(0,s.jsx)("input",{type:a,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...n})});n.displayName="Input"},2643:(e,r,t)=>{"use strict";t.d(r,{U:()=>a});var s=t(3865);function a(){return(0,s.createBrowserClient)("https://noyztbqdgfniixzmpuac.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5veXp0YnFkZ2ZuaWl4em1wdWFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyOTcwNzEsImV4cCI6MjA2ODg3MzA3MX0.WcQOBRjEYQun3eFIzSrupRFmjJArY2jXToMURoylciY")}},3125:(e,r,t)=>{"use strict";t.d(r,{L:()=>s});let s=(0,t(8693).vt)((e,r)=>({conversations:[],selectedConversation:null,setConversations:r=>e({conversations:r}),selectConversation:t=>{if(!t)return void e({selectedConversation:null});let s=r().conversations.find(e=>e.id===t);e(e=>({selectedConversation:s||null,conversations:e.conversations.map(e=>e.id===t?{...e,unread:!1}:e)}))},addMessage:(r,t)=>{e(e=>({conversations:e.conversations.map(e=>e.id===r?{...e,messages:[...e.messages,t],timestamp:new Date().toISOString()}:e)}))}}))},6424:(e,r,t)=>{"use strict";t.d(r,{F:()=>i});var s=t(5155),a=t(2115),l=t(7655),n=t(9434);let i=a.forwardRef((e,r)=>{let{className:t,children:a,...i}=e;return(0,s.jsxs)(l.bL,{ref:r,className:(0,n.cn)("relative overflow-hidden",t),...i,children:[(0,s.jsx)(l.LM,{className:"h-full w-full rounded-[inherit]",children:a}),(0,s.jsx)(d,{}),(0,s.jsx)(l.OK,{})]})});i.displayName=l.bL.displayName;let d=a.forwardRef((e,r)=>{let{className:t,orientation:a="vertical",...i}=e;return(0,s.jsx)(l.VM,{ref:r,orientation:a,className:(0,n.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...i,children:(0,s.jsx)(l.lr,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=l.VM.displayName},6695:(e,r,t)=>{"use strict";t.d(r,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>n,aR:()=>i,wL:()=>u});var s=t(5155),a=t(2115),l=t(9434);let n=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a})});n.displayName="Card";let i=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",t),...a})});i.displayName="CardHeader";let d=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",t),...a})});d.displayName="CardTitle";let o=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,l.cn)("text-sm text-muted-foreground",t),...a})});o.displayName="CardDescription";let c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,l.cn)("p-6 pt-0",t),...a})});c.displayName="CardContent";let u=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)("div",{ref:r,className:(0,l.cn)("flex items-center p-6 pt-0",t),...a})});u.displayName="CardFooter"},6741:(e,r,t)=>{Promise.resolve().then(t.bind(t,8497))},8497:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>A});var s=t(5155),a=t(2115),l=t(285),n=t(2523),i=t(6424),d=t(1394),o=t(172),c=t(3672),u=t(9434),m=t(9137),f=t(9576),h=t(7426);function x(e){let{conversationId:r,recipient:t}=e,{user:x,supabase:v}=(0,f.A)(),[g,b]=(0,a.useState)([]),{t:y,locale:j}=(0,m.B)(),[N,w]=(0,a.useState)(""),[_,k]=(0,a.useState)(!1),[A,C]=(0,a.useState)(!0),I=(0,a.useRef)(null),S=(0,a.useCallback)(()=>{setTimeout(()=>{if(I.current){let e=I.current.querySelector("div[data-radix-scroll-area-viewport]");e&&(e.scrollTop=e.scrollHeight)}},100)},[]);(0,a.useEffect)(()=>{(async()=>{if(!r||!v)return;C(!0);let{data:e,error:t}=await v.from("messages").select("*").eq("conversation_id",r).order("created_at",{ascending:!0});t?(console.error("Error fetching messages:",t),b([])):b(e.map(e=>({id:e.id.toString(),text:e.content,sender:e.sender_id===(null==x?void 0:x.id)?"buyer":"seller",timestamp:(0,h.GP)(new Date(e.created_at),"p")}))),C(!1)})()},[r,v,null==x?void 0:x.id]),(0,a.useEffect)(()=>{S()},[g,S]),(0,a.useEffect)(()=>{if(!v||!r)return;let e=v.channel("chat:".concat(r)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"conversation_id=eq.".concat(r)},e=>{let r=e.new,t={id:r.id.toString(),text:r.content,sender:r.sender_id===(null==x?void 0:x.id)?"buyer":"seller",timestamp:(0,h.GP)(new Date(r.created_at),"p")};b(e=>[...e,t])}).subscribe();return()=>{v.removeChannel(e)}},[v,r,null==x?void 0:x.id]);let R=async e=>{if(e.preventDefault(),!N.trim()||!x||!v)return;k(!0);let{error:t}=await v.from("messages").insert({conversation_id:r,sender_id:x.id,content:N});t?(console.error("Error sending message:",t),p({title:"Error",description:"Could not send message.",variant:"destructive"})):w(""),k(!1)},E=e=>"buyer"===e?null==x?void 0:x.user_metadata.avatar_url:t.avatar_url,M=e=>{let r="buyer"===e?null==x?void 0:x.user_metadata.full_name:t.full_name;return r?r.charAt(0).toUpperCase():"U"};return A?(0,s.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,s.jsx)(o.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)(i.F,{className:"flex-grow p-4 pr-2",ref:I,children:(0,s.jsxs)("div",{className:"space-y-4",children:[g.map(e=>(0,s.jsxs)("div",{className:(0,u.cn)("flex items-end gap-2","buyer"===e.sender?"justify-end":"justify-start"),children:["seller"===e.sender&&(0,s.jsxs)(d.Avatar,{className:"h-8 w-8",children:[(0,s.jsx)(d.AvatarImage,{src:E("seller")||void 0}),(0,s.jsx)(d.AvatarFallback,{children:M("seller")})]}),(0,s.jsxs)("div",{className:(0,u.cn)("max-w-xs rounded-lg p-3 text-sm","buyer"===e.sender?"bg-primary text-primary-foreground":"bg-muted"),children:[(0,s.jsx)("p",{children:e.text}),(0,s.jsx)("p",{className:"text-xs opacity-70 mt-1 text-right",children:e.timestamp})]}),"buyer"===e.sender&&(0,s.jsxs)(d.Avatar,{className:"h-8 w-8",children:[(0,s.jsx)(d.AvatarImage,{src:E("buyer")||void 0}),(0,s.jsx)(d.AvatarFallback,{children:M("buyer")})]})]},e.id)),_&&(0,s.jsxs)("div",{className:"flex items-end gap-2 justify-start",children:[(0,s.jsxs)(d.Avatar,{className:"h-8 w-8",children:[(0,s.jsx)(d.AvatarImage,{src:E("buyer")||void 0}),(0,s.jsx)(d.AvatarFallback,{children:M("buyer")})]}),(0,s.jsx)("div",{className:"bg-muted rounded-lg p-3 flex items-center",children:(0,s.jsx)(o.A,{className:"h-5 w-5 animate-spin text-muted-foreground"})})]})]})}),(0,s.jsxs)("form",{onSubmit:R,className:"flex items-center gap-2 border-t p-4",children:[(0,s.jsx)(n.p,{value:N,onChange:e=>w(e.target.value),placeholder:y("chat.placeholder"),autoComplete:"off",disabled:_}),(0,s.jsx)(l.$,{type:"submit",size:"icon",disabled:_||!N.trim(),children:(0,s.jsx)(c.A,{className:"h-4 w-4"})})]})]})}let p=e=>console.log("Toast:",e.title);var v=t(6695),g=t(18),b=t(8224),y=t(3125),j=t(6874),N=t.n(j),w=t(498),_=t(1055),k=t(1306);function A(){let{user:e,loading:r,supabase:t}=(0,f.A)(),{conversations:l,selectedConversation:n,selectConversation:i,setConversations:c}=(0,y.L)(),{t:h,locale:p}=(0,m.B)(),[j,A]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let s=async()=>{if(!e||!t)return;A(!0);let{data:r,error:s}=await t.from("conversations").select("\n          id,\n          created_at,\n          property_id,\n          buyer_id,\n          seller_id,\n          property:properties(id, title, images),\n          buyer:profiles!conversations_buyer_id_fkey(user_id, full_name, avatar_url),\n          seller:profiles!conversations_seller_id_fkey(user_id, full_name, avatar_url),\n          messages:messages(content, created_at, sender_id)\n        ").or("buyer_id.eq.".concat(e.id,",seller_id.eq.").concat(e.id)).order("created_at",{referencedTable:"messages",ascending:!1});s?console.error("Error fetching conversations:",s):c(r.map(r=>{var t,s,a;let l=r.buyer_id===e.id?r.seller:r.buyer,n=r.messages[0];return{id:r.id.toString(),user:{user_id:l.user_id,full_name:l.full_name,avatar_url:l.avatar_url,username:null},property:{...C,id:(null==(t=r.property)?void 0:t.id)||"unknown",title:(null==(s=r.property)?void 0:s.title)||"Conversation",images:(null==(a=r.property)?void 0:a.images)||[]},messages:[],timestamp:n?n.created_at:r.created_at,lastMessage:(null==n?void 0:n.content)||"No messages yet.",unread:Math.random()>.5}})),A(!1)};r||s()},[e,r,t,c]);let I=e=>{let r=new Date(e);return(0,w.m)(r,{addSuffix:!0,locale:"es"===p?_.es:k.c})};return j||r?(0,s.jsx)("div",{className:"flex justify-center items-center min-h-[calc(100vh-8rem)]",children:(0,s.jsx)(o.A,{className:"h-16 w-16 animate-spin text-primary"})}):0===l.length?(0,s.jsxs)("div",{className:"text-center py-24 bg-card rounded-xl border border-dashed flex flex-col items-center container mx-auto mt-8",children:[(0,s.jsx)(g.A,{className:"w-16 h-16 text-muted-foreground/50 mb-4"}),(0,s.jsx)("h2",{className:"text-2xl font-semibold mb-2 text-primary",children:h("messages.empty.title")}),(0,s.jsx)("p",{className:"text-muted-foreground mb-6",children:h("messages.empty.description")}),(0,s.jsx)(N(),{href:"/",children:(0,s.jsx)("div",{className:"text-primary hover:underline",children:h("messages.empty.button")})})]}):(0,s.jsxs)("div",{className:"container mx-auto py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"font-headline text-4xl font-bold text-primary mb-2",children:h("messages.title")}),(0,s.jsx)("p",{className:"text-lg text-muted-foreground",children:h("messages.subtitle")})]}),(0,s.jsxs)(v.Zp,{className:"h-[calc(100vh-18rem)] flex overflow-hidden",children:[(0,s.jsxs)("div",{className:"w-1/3 border-r overflow-y-auto",children:[(0,s.jsxs)("div",{className:"p-4 font-semibold border-b",children:[h("messages.allMessages")," (",l.length,")"]}),(0,s.jsx)("nav",{className:"p-2 space-y-1",children:l.map(e=>{var r;return(0,s.jsxs)("button",{onClick:()=>i(e.id),className:(0,u.cn)("w-full text-left p-3 rounded-lg flex items-start gap-3 transition-colors",(null==n?void 0:n.id)===e.id?"bg-muted":"hover:bg-muted/50"),children:[(0,s.jsx)(N(),{href:"/profile/".concat(e.user.user_id),onClick:e=>e.stopPropagation(),children:(0,s.jsxs)(d.Avatar,{className:"h-10 w-10 hover:ring-2 hover:ring-primary transition-all",children:[(0,s.jsx)(d.AvatarImage,{src:e.user.avatar_url||void 0}),(0,s.jsx)(d.AvatarFallback,{children:null==(r=e.user.full_name)?void 0:r.charAt(0)})]})}),(0,s.jsxs)("div",{className:"flex-grow overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(N(),{href:"/profile/".concat(e.user.user_id),onClick:e=>e.stopPropagation(),children:(0,s.jsx)("p",{className:"font-semibold text-sm truncate hover:underline",children:e.user.full_name})}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground flex-shrink-0",children:I(e.timestamp)})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground truncate",children:[h("messages.re")," ",h(e.property.title)]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.lastMessage})]}),e.unread&&(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-primary mt-1 flex-shrink-0"})]},e.id)})})]}),(0,s.jsx)("div",{className:"w-2/3 flex flex-col",children:n?(0,s.jsx)(x,{conversationId:n.id,recipient:n.user},n.id):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground",children:[(0,s.jsx)(b.A,{className:"h-16 w-16 mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-semibold",children:h("messages.select.title")}),(0,s.jsx)("p",{children:h("messages.select.description")})]})})]})]})}let C={id:"mock",title:"mock",price:0,location:"mock",address:"mock",type:"house",bedrooms:0,bathrooms:0,area:0,description:"mock",features:[],images:[],realtor_id:"mock",realtor:{user_id:"mock",full_name:"mock",avatar_url:"mock",username:"mock"}}},9137:(e,r,t)=>{"use strict";t.d(r,{B:()=>l});var s=t(2115),a=t(1859);let l=()=>{let e=(0,s.useContext)(a.s);if(!e)throw Error("useTranslation must be used within a LanguageProvider");let{translations:r,locale:t,setLocale:l}=e;return{t:(0,s.useCallback)((e,t)=>{let s=e.split(".").reduce((e,r)=>e?e[r]:void 0,r)||e;return t&&Object.keys(t).forEach(e=>{s=s.replace("{".concat(e,"}"),String(t[e]))}),s},[r]),locale:t,setLocale:l}}},9434:(e,r,t)=>{"use strict";t.d(r,{cn:()=>l,d:()=>n});var s=t(2596),a=t(9688);function l(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.QP)((0,s.$)(r))}async function n(e,r,t){let s=r.getContext("2d");if(!s)throw Error("No 2d context");let a=e.naturalWidth/e.width,l=e.naturalHeight/e.height,n=window.devicePixelRatio;r.width=Math.floor(t.width*a*n),r.height=Math.floor(t.height*l*n),s.scale(n,n),s.imageSmoothingQuality="high";let i=t.x*a,d=t.y*l,o=e.naturalWidth/2,c=e.naturalHeight/2;s.save(),s.translate(-i,-d),s.translate(o,c),s.translate(-o,-c),s.drawImage(e,0,0,e.naturalWidth,e.naturalHeight,0,0,e.naturalWidth,e.naturalHeight),s.restore()}},9576:(e,r,t)=>{"use strict";t.d(r,{A:()=>o,AuthProvider:()=>d});var s=t(5155),a=t(2115),l=t(5695),n=t(2643);let i=(0,a.createContext)(void 0),d=e=>{let{children:r}=e,t=(0,n.U)(),d=(0,l.useRouter)(),[o,c]=(0,a.useState)(null),[u,m]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let{data:{subscription:e}}=t.auth.onAuthStateChange((e,r)=>{var t;c(null!=(t=null==r?void 0:r.user)?t:null),m(!1),"SIGNED_IN"===e&&d&&d.refresh()});return()=>{e.unsubscribe()}},[t,d]);let f=async(e,r)=>{let{error:s}=await t.auth.signInWithPassword({email:e,password:r});return{error:s}},h=async()=>{await t.auth.signOut(),c(null)},x=async(e,r,s)=>{let{data:a,error:l}=await t.auth.signUp({email:r,password:s,options:{data:{full_name:e,avatar_url:"https://placehold.co/128x128.png?text=".concat(e.charAt(0))}}});return{error:l}};return(0,s.jsx)(i.Provider,{value:{user:o,loading:u,login:f,logout:h,signup:x,supabase:t},children:r})},o=()=>{let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var r=r=>e(e.s=r);e.O(0,[941,271,53,355,207,859,441,684,358],()=>r(6741)),_N_E=e.O()}]);