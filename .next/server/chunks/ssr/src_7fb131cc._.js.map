{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/scroll-area.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,8OAAC,0KAAA,CAAA,OAAwB;QACvB,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,4BAA4B;QACzC,GAAG,KAAK;;0BAET,8OAAC,0KAAA,CAAA,WAA4B;gBAAC,WAAU;0BACrC;;;;;;0BAEH,8OAAC;;;;;0BACD,8OAAC,0KAAA,CAAA,SAA0B;;;;;;;;;;;AAG/B,WAAW,WAAW,GAAG,0KAAA,CAAA,OAAwB,CAAC,WAAW;AAE7D,MAAM,0BAAY,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAG/B,CAAC,EAAE,SAAS,EAAE,cAAc,UAAU,EAAE,GAAG,OAAO,EAAE,oBACpD,8OAAC,0KAAA,CAAA,sBAAuC;QACtC,KAAK;QACL,aAAa;QACb,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,iDACA,gBAAgB,cACd,sDACF,gBAAgB,gBACd,wDACF;QAED,GAAG,KAAK;kBAET,cAAA,8OAAC,0KAAA,CAAA,kBAAmC;YAAC,WAAU;;;;;;;;;;;AAGnD,UAAU,WAAW,GAAG,0KAAA,CAAA,sBAAuC,CAAC,WAAW","debugId":null}},
    {"offset": {"line": 75, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/chat/ChatWindow.tsx"],"sourcesContent":["\n'use client';\n\nimport { useState, useRef, useEffect, useCallback } from 'react';\nimport type { Message, UserProfile } from '@/types';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Send, Loader2 } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useAuth } from '@/context/AuthContext';\nimport { format } from 'date-fns';\nimport { useChatStore } from './use-chat-store';\n\ninterface ChatWindowProps {\n  conversationId: string;\n}\n\nexport function ChatWindow({ conversationId }: ChatWindowProps) {\n  const { user: authUser, supabase } = useAuth();\n  const { selectedConversation } = useChatStore();\n\n  const [messages, setMessages] = useState<Message[]>([]);\n  const { t } = useTranslation();\n  \n  const [newMessage, setNewMessage] = useState('');\n  const [isSending, setIsSending] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\n\n  const recipient = selectedConversation?.otherUser;\n\n  const scrollToBottom = useCallback(() => {\n    setTimeout(() => {\n       if (scrollAreaRef.current) {\n        const viewport = scrollAreaRef.current.querySelector('div[data-radix-scroll-area-viewport]');\n        if (viewport) {\n          viewport.scrollTop = viewport.scrollHeight;\n        }\n      }\n    }, 100);\n  }, []);\n  \n  useEffect(() => {\n    const fetchMessages = async () => {\n        if (!conversationId || !supabase) return;\n        setIsLoading(true);\n\n        const { data, error } = await supabase\n            .from('messages')\n            .select('*')\n            .eq('conversation_id', conversationId)\n            .order('created_at', { ascending: true });\n\n        if (error) {\n            console.error(\"Error fetching messages:\", error);\n            setMessages([]);\n        } else {\n            setMessages(data as Message[]);\n        }\n        setIsLoading(false);\n    }\n    fetchMessages();\n  }, [conversationId, supabase]);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, scrollToBottom]);\n  \n  useEffect(() => {\n      if (!supabase || !conversationId) return;\n\n      const channel = supabase.channel(`chat:${conversationId}`)\n        .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages', filter: `conversation_id=eq.${conversationId}` }, \n        (payload) => {\n            const newMessage = payload.new as Message;\n            setMessages(currentMessages => [...currentMessages, newMessage]);\n        })\n        .subscribe();\n      \n      return () => {\n        supabase.removeChannel(channel);\n      }\n\n  }, [supabase, conversationId, authUser?.id]);\n\n\n  const handleSendMessage = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!newMessage.trim() || !authUser || !supabase || !selectedConversation) return;\n\n    setIsSending(true);\n\n    const textToSend = newMessage;\n    setNewMessage(''); // Clear input immediately for better UX\n\n    const { error } = await supabase\n      .from('messages')\n      .insert({\n        conversation_id: selectedConversation.id,\n        sender_id: authUser.id,\n        content: textToSend,\n      });\n\n    if (error) {\n        console.error(\"Error sending message:\", error);\n        toast({ title: \"Error\", description: \"Could not send message.\", variant: \"destructive\" });\n        setNewMessage(textToSend); // Restore message on error\n    }\n    \n    setIsSending(false);\n  };\n  \n  const getAvatar = (senderId: string) => {\n    return senderId === authUser?.id ? authUser?.user_metadata.avatar_url : recipient?.avatar_url;\n  };\n\n  const getInitial = (senderId: string) => {\n    const name = senderId === authUser?.id ? authUser?.user_metadata.full_name : recipient?.full_name;\n    return name ? name.charAt(0).toUpperCase() : 'U';\n  }\n\n  if (isLoading) {\n    return (\n        <div className=\"flex justify-center items-center h-full\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n    );\n  }\n\n  if (!recipient) {\n     return (\n        <div className=\"flex justify-center items-center h-full\">\n            <p>Error: No recipient found for this conversation.</p>\n        </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      <ScrollArea className=\"flex-grow p-4 pr-2\" ref={scrollAreaRef}>\n        <div className=\"space-y-4\">\n          {messages.map((message) => (\n            <div\n              key={message.id}\n              className={cn(\n                'flex items-end gap-2',\n                message.sender_id === authUser?.id ? 'justify-end' : 'justify-start'\n              )}\n            >\n              {message.sender_id !== authUser?.id && (\n                <Avatar className=\"h-8 w-8\">\n                  <AvatarImage src={getAvatar(message.sender_id) || undefined} />\n                  <AvatarFallback>{getInitial(message.sender_id)}</AvatarFallback>\n                </Avatar>\n              )}\n              <div\n                className={cn(\n                  'max-w-xs rounded-lg p-3 text-sm',\n                  message.sender_id === authUser?.id\n                    ? 'bg-primary text-primary-foreground'\n                    : 'bg-muted'\n                )}\n              >\n                <p>{message.content}</p>\n                <p className=\"text-xs opacity-70 mt-1 text-right\">{format(new Date(message.created_at), 'p')}</p>\n              </div>\n              {message.sender_id === authUser?.id && (\n                <Avatar className=\"h-8 w-8\">\n                  <AvatarImage src={getAvatar(message.sender_id) || undefined} />\n                  <AvatarFallback>{getInitial(message.sender_id)}</AvatarFallback>\n                </Avatar>\n              )}\n            </div>\n          ))}\n          {isSending && (\n             <div className=\"flex items-end gap-2 justify-end\">\n                 <div className=\"bg-primary rounded-lg p-3 flex items-center\">\n                    <Loader2 className=\"h-5 w-5 animate-spin text-primary-foreground\" />\n                 </div>\n                <Avatar className=\"h-8 w-8\">\n                  <AvatarImage src={getAvatar(authUser?.id || '') || undefined} />\n                  <AvatarFallback>{getInitial(authUser?.id || '')}</AvatarFallback>\n                </Avatar>\n             </div>\n          )}\n        </div>\n      </ScrollArea>\n      <form\n        onSubmit={handleSendMessage}\n        className=\"flex items-center gap-2 border-t p-4\"\n      >\n        <Input\n          value={newMessage}\n          onChange={(e) => setNewMessage(e.target.value)}\n          placeholder={t('chat.placeholder')}\n          autoComplete=\"off\"\n          disabled={isSending}\n        />\n        <Button type=\"submit\" size=\"icon\" disabled={isSending || !newMessage.trim()}>\n          <Send className=\"h-4 w-4\" />\n        </Button>\n      </form>\n    </div>\n  );\n}\n\n// Dummy toast for now\nconst toast = (props: any) => console.log('Toast:', props.title);\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 430, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n"],"names":[],"mappings":";;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,qBAAO,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAG1B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,4DACA;QAED,GAAG,KAAK;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,sDACA;QAED,GAAG,KAAK;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGrC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QAAI,KAAK;QAAK,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,YAAY;QAAa,GAAG,KAAK;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 511, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28main%29/messages/page.tsx"],"sourcesContent":["\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { ChatWindow } from '@/components/chat/ChatWindow';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Card } from '@/components/ui/card';\nimport { Loader2, MessageCircle, MessagesSquare } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useChatStore } from '@/components/chat/use-chat-store';\nimport Link from 'next/link';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { useAuth } from '@/context/AuthContext';\nimport { formatDistanceToNow } from 'date-fns';\nimport { es, enUS } from 'date-fns/locale';\n\nexport default function MessagesPage() {\n  const { user, loading: authLoading } = useAuth();\n  const { conversations, selectedConversation, selectConversation, loading: chatLoading } = useChatStore();\n  const { t, locale } = useTranslation();\n  \n  const isLoading = authLoading || chatLoading;\n  \n  const getTimestamp = (timestamp: string) => {\n    if (!timestamp) return \"just now\";\n    try {\n        const date = new Date(timestamp);\n        return formatDistanceToNow(date, { addSuffix: true, locale: locale === 'es' ? es : enUS });\n    } catch(e) {\n        return \"just now\"\n    }\n  }\n\n  if (isLoading) {\n     return (\n        <div className=\"flex justify-center items-center min-h-[calc(100vh-8rem)]\">\n            <Loader2 className=\"h-16 w-16 animate-spin text-primary\" />\n        </div>\n    );\n  }\n\n  if (conversations.length === 0) {\n    return (\n      <div className=\"text-center py-24 bg-card rounded-xl border border-dashed flex flex-col items-center container mx-auto mt-8\">\n        <MessagesSquare className=\"w-16 h-16 text-muted-foreground/50 mb-4\" />\n        <h2 className=\"text-2xl font-semibold mb-2 text-primary\">\n          {t('messages.empty.title')}\n        </h2>\n        <p className=\"text-muted-foreground mb-6\">\n          {t('messages.empty.description')}\n        </p>\n         <Link href=\"/\">\n            <div className='text-primary hover:underline'>{t('messages.empty.button')}</div>\n          </Link>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto py-8\">\n       <div className=\"mb-8\">\n        <h1 className=\"font-headline text-4xl font-bold text-primary mb-2\">\n          {t('messages.title')}\n        </h1>\n        <p className=\"text-lg text-muted-foreground\">\n          {t('messages.subtitle')}\n        </p>\n      </div>\n      <Card className=\"h-[calc(100vh-18rem)] flex overflow-hidden\">\n        <div className=\"w-1/3 border-r overflow-y-auto\">\n          <div className=\"p-4 font-semibold border-b\">\n            {t('messages.allMessages')} ({conversations.length})\n          </div>\n          <nav className=\"p-2 space-y-1\">\n            {conversations.map((convo) => (\n              <button\n                key={convo.id}\n                onClick={() => selectConversation(convo.id)}\n                className={cn(\n                  \"w-full text-left p-3 rounded-lg flex items-start gap-3 transition-colors\",\n                  selectedConversation?.id === convo.id ? \"bg-muted\" : \"hover:bg-muted/50\"\n                )}\n              >\n                <Link href={`/profile/${convo.otherUser.user_id}`} onClick={(e) => e.stopPropagation()}>\n                    <Avatar className=\"h-10 w-10 hover:ring-2 hover:ring-primary transition-all\">\n                      <AvatarImage src={convo.otherUser.avatar_url || undefined} />\n                      <AvatarFallback>{convo.otherUser.full_name?.charAt(0)}</AvatarFallback>\n                    </Avatar>\n                </Link>\n                <div className=\"flex-grow overflow-hidden\">\n                   <div className=\"flex justify-between items-center\">\n                    <Link href={`/profile/${convo.otherUser.user_id}`} onClick={(e) => e.stopPropagation()}>\n                        <p className=\"font-semibold text-sm truncate hover:underline\">{convo.otherUser.full_name}</p>\n                    </Link>\n                     <p className=\"text-xs text-muted-foreground flex-shrink-0\">{getTimestamp(convo.created_at)}</p>\n                   </div>\n                   <p className=\"text-sm text-muted-foreground truncate\">{ convo.lastMessage }</p>\n                </div>\n                 {!convo.last_message_read && convo.last_message_sender_id !== user?.id && <div className=\"w-2 h-2 rounded-full bg-primary mt-1 flex-shrink-0\"></div>}\n              </button>\n            ))}\n          </nav>\n        </div>\n        <div className=\"w-2/3 flex flex-col\">\n          {selectedConversation ? (\n            <ChatWindow\n              key={selectedConversation.id}\n              conversationId={selectedConversation.id}\n            />\n          ) : (\n            <div className=\"flex flex-col items-center justify-center h-full text-center text-muted-foreground\">\n                <MessageCircle className=\"h-16 w-16 mb-4\" />\n                <h2 className=\"text-xl font-semibold\">{t('messages.select.title')}</h2>\n                <p>{t('messages.select.description')}</p>\n            </div>\n          )}\n        </div>\n      </Card>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}